# qdrant_client_wrapper.py ä»•æ§˜æ›¸

ä½œæˆæ—¥: 2025-11-27

## æ¦‚è¦

Qdrantãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ã®æ“ä½œã‚’ä¸€å…ƒç®¡ç†ã™ã‚‹ãƒ©ãƒƒãƒ‘ãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€‚`qdrant_client`ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨`OpenAI`åŸ‹ã‚è¾¼ã¿APIã‚’ãƒ©ãƒƒãƒ”ãƒ³ã‚°ã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®è¨­å®šãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’æä¾›ã€‚

## ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±

- **ãƒ•ã‚¡ã‚¤ãƒ«å**: qdrant_client_wrapper.py
- **è¡Œæ•°**: 893è¡Œ
- **ä¸»ãªæ©Ÿèƒ½**: Qdrantæ“ä½œã®ãƒ©ãƒƒãƒ”ãƒ³ã‚°
- **ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: qdrant_clientã€openaiã€tiktokenã€pandas

## ä½¿ç”¨ç®‡æ‰€

- `rag_qa_pair_qdrant.py`
- `a42_qdrant_registration.py`
- `a50_rag_search_local_qdrant.py`

---

## ãƒ©ãƒƒãƒ”ãƒ³ã‚°æ§‹é€ å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    qdrant_client_wrapper.py                          â”‚
â”‚                     (ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå°‚ç”¨ãƒ©ãƒƒãƒ‘ãƒ¼)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   QdrantConfig      â”‚      â”‚   OpenAI API         â”‚              â”‚
â”‚  â”‚   (config.py)       â”‚      â”‚   (åŸ‹ã‚è¾¼ã¿)          â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚             â”‚                            â”‚                           â”‚
â”‚             â–¼                            â–¼                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚                  å®šæ•°ãƒ»è¨­å®š                               â”‚       â”‚
â”‚  â”‚  QDRANT_CONFIG, COLLECTION_EMBEDDINGS, etc.              â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚               QdrantHealthChecker                         â”‚       â”‚
â”‚  â”‚  â”œâ”€â”€ check_port()      â†’ socket.connect_ex()             â”‚       â”‚
â”‚  â”‚  â”œâ”€â”€ check_qdrant()    â†’ QdrantClient.get_collections()  â”‚       â”‚
â”‚  â”‚  â””â”€â”€ get_client()      â†’ QdrantClient                    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚               ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†é–¢æ•°                         â”‚       â”‚
â”‚  â”‚  â”œâ”€â”€ create_qdrant_client()    â†’ QdrantClient()          â”‚       â”‚
â”‚  â”‚  â”œâ”€â”€ get_collection_stats()    â†’ client.get_collection() â”‚       â”‚
â”‚  â”‚  â”œâ”€â”€ get_all_collections()     â†’ client.get_collections()â”‚       â”‚
â”‚  â”‚  â”œâ”€â”€ delete_all_collections()  â†’ client.delete_collectionâ”‚       â”‚
â”‚  â”‚  â””â”€â”€ create_or_recreate_collection()                     â”‚       â”‚
â”‚  â”‚       â†’ client.create_collection() + payload_index       â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚               åŸ‹ã‚è¾¼ã¿é–¢æ•°                                â”‚       â”‚
â”‚  â”‚  â”œâ”€â”€ embed_texts()     â†’ OpenAI.embeddings.create()      â”‚       â”‚
â”‚  â”‚  â”‚   (ãƒãƒƒãƒå‡¦ç† + ãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™ç®¡ç†)                      â”‚       â”‚
â”‚  â”‚  â””â”€â”€ embed_query()     â†’ OpenAI.embeddings.create()      â”‚       â”‚
â”‚  â”‚       (å˜ä¸€ãƒ†ã‚­ã‚¹ãƒˆ + æ¬¡å…ƒæŒ‡å®šå¯¾å¿œ)                       â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚               ãƒã‚¤ãƒ³ãƒˆæ“ä½œé–¢æ•°                            â”‚       â”‚
â”‚  â”‚  â”œâ”€â”€ build_points()    â†’ models.PointStructæ§‹ç¯‰          â”‚       â”‚
â”‚  â”‚  â””â”€â”€ upsert_points()   â†’ client.upsert()                 â”‚       â”‚
â”‚  â”‚       (ãƒãƒƒãƒå‡¦ç†å¯¾å¿œ)                                    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚               QdrantDataFetcher                          â”‚       â”‚
â”‚  â”‚  â”œâ”€â”€ fetch_collections()         â†’ DataFrame             â”‚       â”‚
â”‚  â”‚  â”œâ”€â”€ fetch_collection_points()   â†’ client.scroll()       â”‚       â”‚
â”‚  â”‚  â”œâ”€â”€ fetch_collection_info()     â†’ client.get_collection â”‚       â”‚
â”‚  â”‚  â””â”€â”€ fetch_collection_source_info()  â†’ çµ±è¨ˆæƒ…å ±          â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚               æ¤œç´¢é–¢æ•°                                    â”‚       â”‚
â”‚  â”‚  â””â”€â”€ search_collection()  â†’ client.search()              â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    qdrant_client (å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  QdrantClient                                                        â”‚
â”‚  â”œâ”€â”€ get_collections()                                              â”‚
â”‚  â”œâ”€â”€ get_collection()                                               â”‚
â”‚  â”œâ”€â”€ create_collection()                                            â”‚
â”‚  â”œâ”€â”€ delete_collection()                                            â”‚
â”‚  â”œâ”€â”€ create_payload_index()                                         â”‚
â”‚  â”œâ”€â”€ upsert()                                                       â”‚
â”‚  â”œâ”€â”€ scroll()                                                       â”‚
â”‚  â””â”€â”€ search()                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹é€ 

```
qdrant_client_wrapper.py
â”œâ”€â”€ ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ»è¨­å®š (L1-45)
â”‚
â”œâ”€â”€ å®šæ•° (L48-86)
â”‚   â”œâ”€â”€ QDRANT_CONFIG (L53-61)
â”‚   â”œâ”€â”€ DEFAULT_EMBEDDING_MODEL (L64)
â”‚   â”œâ”€â”€ DEFAULT_VECTOR_SIZE (L65)
â”‚   â”œâ”€â”€ COLLECTION_EMBEDDINGS (L68-76)
â”‚   â””â”€â”€ COLLECTION_CSV_MAPPING (L79-86)
â”‚
â”œâ”€â”€ ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•° (L89-111)
â”‚   â””â”€â”€ batched() (L93-111)
â”‚
â”œâ”€â”€ Qdrantæ¥ç¶šãƒ»ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ (L114-198)
â”‚   â”œâ”€â”€ QdrantHealthChecker (L118-183)
â”‚   â””â”€â”€ create_qdrant_client() (L186-198)
â”‚
â”œâ”€â”€ ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç† (L201-360)
â”‚   â”œâ”€â”€ get_collection_stats() (L205-252)
â”‚   â”œâ”€â”€ get_all_collections() (L255-283)
â”‚   â”œâ”€â”€ delete_all_collections() (L286-317)
â”‚   â””â”€â”€ create_or_recreate_collection() (L320-359)
â”‚
â”œâ”€â”€ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ»å¤‰æ› (L362-420)
â”‚   â”œâ”€â”€ load_csv_for_qdrant() (L366-404)
â”‚   â””â”€â”€ build_inputs_for_embedding() (L407-420)
â”‚
â”œâ”€â”€ åŸ‹ã‚è¾¼ã¿ç”Ÿæˆ (L423-525)
â”‚   â”œâ”€â”€ embed_texts() (L427-498)
â”‚   â””â”€â”€ embed_query() (L501-525)
â”‚
â”œâ”€â”€ ãƒã‚¤ãƒ³ãƒˆä½œæˆãƒ»ã‚¢ãƒƒãƒ—ã‚µãƒ¼ãƒˆ (L528-595)
â”‚   â”œâ”€â”€ build_points() (L532-570)
â”‚   â””â”€â”€ upsert_points() (L573-595)
â”‚
â”œâ”€â”€ ãƒ‡ãƒ¼ã‚¿å–å¾— (L598-787)
â”‚   â””â”€â”€ QdrantDataFetcher (L602-787)
â”‚
â”œâ”€â”€ æ¤œç´¢ (L790-829)
â”‚   â””â”€â”€ search_collection() (L794-829)
â”‚
â”œâ”€â”€ å¾Œæ–¹äº’æ›æ€§ã‚¨ã‚¤ãƒªã‚¢ã‚¹ (L832-841)
â”‚
â””â”€â”€ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®šç¾© (L844-893)
```

---

## ãƒ©ãƒƒãƒ”ãƒ³ã‚°è©³ç´°

### 1. è¨­å®šã®ãƒ©ãƒƒãƒ”ãƒ³ã‚°

**å…ƒã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: `qdrant_client.QdrantClient` ã¯å€‹åˆ¥ã« URL/host/port ã‚’æŒ‡å®š

**ãƒ©ãƒƒãƒ‘ãƒ¼**: `config.py` ã® `QdrantConfig` ã‚’ä½¿ç”¨ã—ã¦ä¸€å…ƒç®¡ç†

```python
# å…ƒã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½¿ç”¨
client = QdrantClient(url="http://localhost:6333", timeout=30)

# ãƒ©ãƒƒãƒ‘ãƒ¼ä½¿ç”¨
client = create_qdrant_client()  # è¨­å®šã¯è‡ªå‹•ã§é©ç”¨
```

**è¨­å®šå®šæ•°** (L53-61):
```python
QDRANT_CONFIG = {
    "name": "Qdrant",
    "host": QdrantConfig.HOST,          # "localhost"
    "port": QdrantConfig.PORT,          # 6333
    "icon": "ğŸ¯",
    "url": QdrantConfig.URL,            # "http://localhost:6333"
    "health_check_endpoint": "/collections",
    "docker_image": "qdrant/qdrant",
}
```

---

### 2. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®ãƒ©ãƒƒãƒ”ãƒ³ã‚°

**å…ƒã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: æ¥ç¶šå¤±æ•—æ™‚ã«ä¾‹å¤–ç™ºç”Ÿ

**ãƒ©ãƒƒãƒ‘ãƒ¼**: `QdrantHealthChecker` ã§ãƒãƒ¼ãƒˆãƒã‚§ãƒƒã‚¯ + æ¥ç¶šç¢ºèª + ãƒ¡ãƒˆãƒªã‚¯ã‚¹å–å¾—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  QdrantHealthChecker                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  check_qdrant()                                            â”‚
â”‚       â”‚                                                    â”‚
â”‚       â”œâ”€â”€ 1. check_port() â”€â”€â”€â”€â”€â–º socket.connect_ex()       â”‚
â”‚       â”‚       â”‚                                            â”‚
â”‚       â”‚       â””â”€â”€ False â†’ return (False, "port closed")    â”‚
â”‚       â”‚                                                    â”‚
â”‚       â”œâ”€â”€ 2. QdrantClient() â”€â”€â”€â–º æ¥ç¶šç¢ºç«‹                   â”‚
â”‚       â”‚                                                    â”‚
â”‚       â”œâ”€â”€ 3. get_collections() â†’ ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å–å¾—           â”‚
â”‚       â”‚                                                    â”‚
â”‚       â””â”€â”€ 4. return (True, "Connected", metrics)           â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ãƒ¡ãƒˆãƒªã‚¯ã‚¹å‡ºåŠ›**:
```python
{
    "collection_count": 5,
    "collections": ["qa_corpus", "qa_cc_news_a02_llm", ...],
    "response_time_ms": 15.23
}
```

---

### 3. ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†ã®ãƒ©ãƒƒãƒ”ãƒ³ã‚°

**å…ƒã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: å€‹åˆ¥ã®ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—

**ãƒ©ãƒƒãƒ‘ãƒ¼**: ä¾¿åˆ©é–¢æ•°ã§ã¾ã¨ã‚ã¦å‡¦ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          create_or_recreate_collection()                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  å¼•æ•°: client, name, recreate=False, vector_size=1536      â”‚
â”‚                                                             â”‚
â”‚       â”œâ”€â”€ recreate=True ã®å ´åˆ:                            â”‚
â”‚       â”‚    â”œâ”€â”€ client.delete_collection()                  â”‚
â”‚       â”‚    â””â”€â”€ client.create_collection()                  â”‚
â”‚       â”‚                                                    â”‚
â”‚       â””â”€â”€ recreate=False ã®å ´åˆ:                           â”‚
â”‚            â”œâ”€â”€ client.get_collection()  â† å­˜åœ¨ç¢ºèª         â”‚
â”‚            â””â”€â”€ å­˜åœ¨ã—ãªã‘ã‚Œã° create_collection()          â”‚
â”‚                                                            â”‚
â”‚       æœ€å¾Œã«:                                              â”‚
â”‚       â””â”€â”€ client.create_payload_index("domain")            â”‚
â”‚            (æ¤œç´¢ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è‡ªå‹•ä½œæˆ)                     â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…ƒã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã®å®Ÿè£…**:
```python
# å…ƒã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½¿ç”¨ï¼ˆå†—é•·ï¼‰
try:
    client.delete_collection("my_collection")
except:
    pass
client.create_collection(
    collection_name="my_collection",
    vectors_config=models.VectorParams(size=1536, distance=models.Distance.COSINE)
)
client.create_payload_index(
    "my_collection",
    field_name="domain",
    field_schema=models.PayloadSchemaType.KEYWORD
)

# ãƒ©ãƒƒãƒ‘ãƒ¼ä½¿ç”¨ï¼ˆç°¡æ½”ï¼‰
create_or_recreate_collection(client, "my_collection", recreate=True)
```

---

### 4. åŸ‹ã‚è¾¼ã¿ç”Ÿæˆã®ãƒ©ãƒƒãƒ”ãƒ³ã‚°

**å…ƒã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: OpenAI API ç›´æ¥å‘¼ã³å‡ºã—ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™ãªã—ï¼‰

**ãƒ©ãƒƒãƒ‘ãƒ¼**: ãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™ç®¡ç† + ãƒãƒƒãƒå‡¦ç† + ç©ºæ–‡å­—åˆ—å‡¦ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     embed_texts()                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  å…¥åŠ›: texts: List[str]                                    â”‚
â”‚                                                             â”‚
â”‚  å‡¦ç†ãƒ•ãƒ­ãƒ¼:                                                â”‚
â”‚                                                             â”‚
â”‚  1. ç©ºæ–‡å­—åˆ—ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°                                  â”‚
â”‚     â”œâ”€â”€ ç©º â†’ ãƒ€ãƒŸãƒ¼ãƒ™ã‚¯ãƒˆãƒ« [0.0] * 1536                   â”‚
â”‚     â””â”€â”€ æœ‰åŠ¹ â†’ valid_texts ã«è¿½åŠ                           â”‚
â”‚                                                             â”‚
â”‚  2. ãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™ãƒã‚§ãƒƒã‚¯ (MAX=8000)                         â”‚
â”‚     â””â”€â”€ è¶…é â†’ ValueError                                  â”‚
â”‚                                                             â”‚
â”‚  3. ãƒãƒƒãƒåˆ†å‰² (ãƒˆãƒ¼ã‚¯ãƒ³æ•°ãƒ™ãƒ¼ã‚¹)                           â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚     â”‚ current_batch                           â”‚            â”‚
â”‚     â”‚ â”œâ”€â”€ text1 (500 tokens)                 â”‚            â”‚
â”‚     â”‚ â”œâ”€â”€ text2 (300 tokens)                 â”‚            â”‚
â”‚     â”‚ â””â”€â”€ ... (åˆè¨ˆ < 8000 tokens)           â”‚            â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                             â”‚
â”‚  4. OpenAI APIå‘¼ã³å‡ºã—                                      â”‚
â”‚     â””â”€â”€ client.embeddings.create(model, input)             â”‚
â”‚                                                             â”‚
â”‚  5. å…ƒã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«å†é…ç½®                                â”‚
â”‚     â””â”€â”€ ç©ºæ–‡å­—åˆ—ä½ç½®ã«ãƒ€ãƒŸãƒ¼ãƒ™ã‚¯ãƒˆãƒ«æŒ¿å…¥                    â”‚
â”‚                                                             â”‚
â”‚  å‡ºåŠ›: List[List[float]] (1536æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«)                 â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…ƒã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã®å®Ÿè£…**:
```python
# å…ƒã®OpenAI SDKä½¿ç”¨ï¼ˆåˆ¶é™ãªã—ã€ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿã—ã‚„ã™ã„ï¼‰
response = client.embeddings.create(model="text-embedding-3-small", input=texts)
vectors = [d.embedding for d in response.data]

# ãƒ©ãƒƒãƒ‘ãƒ¼ä½¿ç”¨ï¼ˆå®‰å…¨ï¼‰
vectors = embed_texts(texts, model="text-embedding-3-small", batch_size=128)
```

---

### 5. ãƒã‚¤ãƒ³ãƒˆæ“ä½œã®ãƒ©ãƒƒãƒ”ãƒ³ã‚°

**å…ƒã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: `PointStruct` ã‚’æ‰‹å‹•ã§æ§‹ç¯‰

**ãƒ©ãƒƒãƒ‘ãƒ¼**: DataFrame ã‹ã‚‰è‡ªå‹•æ§‹ç¯‰ + ãƒãƒƒãƒã‚¢ãƒƒãƒ—ã‚µãƒ¼ãƒˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              build_points() + upsert_points()               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  build_points(df, vectors, domain, source_file)            â”‚
â”‚       â”‚                                                    â”‚
â”‚       â”œâ”€â”€ DataFrameè¡Œã‚’ã‚¤ãƒ†ãƒ¬ãƒ¼ãƒˆ                          â”‚
â”‚       â”‚                                                    â”‚
â”‚       â”œâ”€â”€ payloadæ§‹ç¯‰:                                     â”‚
â”‚       â”‚    {                                               â”‚
â”‚       â”‚      "domain": domain,                             â”‚
â”‚       â”‚      "question": row.question,                     â”‚
â”‚       â”‚      "answer": row.answer,                         â”‚
â”‚       â”‚      "source": source_file,                        â”‚
â”‚       â”‚      "created_at": ISOå½¢å¼ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—,          â”‚
â”‚       â”‚      "schema": "qa:v1"                             â”‚
â”‚       â”‚    }                                               â”‚
â”‚       â”‚                                                    â”‚
â”‚       â”œâ”€â”€ IDç”Ÿæˆ: hash(domain-source-index)                â”‚
â”‚       â”‚                                                    â”‚
â”‚       â””â”€â”€ models.PointStruct(id, vector, payload)          â”‚
â”‚                                                             â”‚
â”‚  upsert_points(client, collection, points, batch_size)     â”‚
â”‚       â”‚                                                    â”‚
â”‚       â””â”€â”€ batched(points, 128) ã§ãƒãƒƒãƒå‡¦ç†                â”‚
â”‚            â””â”€â”€ client.upsert(collection, chunk)            â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 6. ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ãƒ©ãƒƒãƒ”ãƒ³ã‚°

**å…ƒã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: `scroll()` ã¯ `(points, next_offset)` ã‚¿ãƒ—ãƒ«ã‚’è¿”ã™

**ãƒ©ãƒƒãƒ‘ãƒ¼**: `QdrantDataFetcher` ã§ DataFrame å½¢å¼ã«å¤‰æ›

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   QdrantDataFetcher                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  fetch_collection_points(collection_name, limit)           â”‚
â”‚       â”‚                                                    â”‚
â”‚       â”œâ”€â”€ client.scroll()                                  â”‚
â”‚       â”‚    â””â”€â”€ returns (points, next_offset)               â”‚
â”‚       â”‚                                                    â”‚
â”‚       â”œâ”€â”€ points[0] ã‹ã‚‰ãƒã‚¤ãƒ³ãƒˆå–å¾—                       â”‚
â”‚       â”‚                                                    â”‚
â”‚       â”œâ”€â”€ å„ãƒã‚¤ãƒ³ãƒˆã‚’è¾æ›¸ã«å¤‰æ›                           â”‚
â”‚       â”‚    â”œâ”€â”€ ID                                          â”‚
â”‚       â”‚    â”œâ”€â”€ payload ã®å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰                      â”‚
â”‚       â”‚    â””â”€â”€ é•·æ–‡ã¯ 200æ–‡å­—ã§åˆ‡ã‚Šè©°ã‚                    â”‚
â”‚       â”‚                                                    â”‚
â”‚       â””â”€â”€ pd.DataFrame(data)                               â”‚
â”‚                                                             â”‚
â”‚  å‡ºåŠ›ã‚¤ãƒ¡ãƒ¼ã‚¸:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ ID   â”‚ question       â”‚ answer           â”‚ domain â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚ 123  â”‚ RAGã¨ã¯ï¼Ÿ      â”‚ RAGã¯æ¤œç´¢æ‹¡å¼µ... â”‚ qa     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 7. æ¤œç´¢ã®ãƒ©ãƒƒãƒ”ãƒ³ã‚°

**å…ƒã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: `search()` ã¯ `ScoredPoint` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™

**ãƒ©ãƒƒãƒ‘ãƒ¼**: è¾æ›¸ãƒªã‚¹ãƒˆã«å¤‰æ› + éæ¨å¥¨è­¦å‘Šã‚’æŠ‘åˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  search_collection()                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  search_collection(client, collection, query_vector, limit)â”‚
â”‚       â”‚                                                    â”‚
â”‚       â”œâ”€â”€ warnings.catch_warnings() ã§è­¦å‘ŠæŠ‘åˆ¶             â”‚
â”‚       â”‚                                                    â”‚
â”‚       â”œâ”€â”€ client.search()                                  â”‚
â”‚       â”‚    â””â”€â”€ returns List[ScoredPoint]                   â”‚
â”‚       â”‚                                                    â”‚
â”‚       â””â”€â”€ è¾æ›¸ãƒªã‚¹ãƒˆã«å¤‰æ›:                                â”‚
â”‚            [                                               â”‚
â”‚              {"score": 0.95, "id": 123, "payload": {...}}, â”‚
â”‚              {"score": 0.87, "id": 456, "payload": {...}}  â”‚
â”‚            ]                                               â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®šæ•°

### QDRANT_CONFIG (L53-61)

| ã‚­ãƒ¼ | å€¤ | èª¬æ˜ |
|------|-----|------|
| `name` | "Qdrant" | è¡¨ç¤ºå |
| `host` | "localhost" | ãƒ›ã‚¹ãƒˆ |
| `port` | 6333 | ãƒãƒ¼ãƒˆ |
| `icon` | "ğŸ¯" | ã‚¢ã‚¤ã‚³ãƒ³ |
| `url` | "http://localhost:6333" | æ¥ç¶šURL |
| `health_check_endpoint` | "/collections" | ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ç”¨ |
| `docker_image` | "qdrant/qdrant" | Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ |

### COLLECTION_EMBEDDINGS (L68-76)

| ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ | ãƒ¢ãƒ‡ãƒ« | æ¬¡å…ƒæ•° |
|-------------|--------|--------|
| qa_corpus | text-embedding-3-small | 1536 |
| qa_cc_news_a02_llm | text-embedding-3-small | 1536 |
| qa_cc_news_a03_rule | text-embedding-3-small | 1536 |
| qa_cc_news_a10_hybrid | text-embedding-3-small | 1536 |
| qa_livedoor_a02_20_llm | text-embedding-3-small | 1536 |
| qa_livedoor_a03_rule | text-embedding-3-small | 1536 |
| qa_livedoor_a10_hybrid | text-embedding-3-small | 1536 |

### COLLECTION_CSV_MAPPING (L79-86)

| ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ | CSVãƒ•ã‚¡ã‚¤ãƒ« |
|-------------|------------|
| qa_cc_news_a02_llm | a02_qa_pairs_cc_news.csv |
| qa_cc_news_a03_rule | a03_qa_pairs_cc_news.csv |
| qa_cc_news_a10_hybrid | a10_qa_pairs_cc_news.csv |
| qa_livedoor_a02_20_llm | a02_qa_pairs_livedoor.csv |
| qa_livedoor_a03_rule | a03_qa_pairs_livedoor.csv |
| qa_livedoor_a10_hybrid | a10_qa_pairs_livedoor.csv |

---

## ä½¿ç”¨ä¾‹

### ä¾‹1: ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

```python
from qdrant_client_wrapper import QdrantHealthChecker

checker = QdrantHealthChecker(debug_mode=True)
is_connected, message, metrics = checker.check_qdrant()

if is_connected:
    print(f"æ¥ç¶šæˆåŠŸ: {metrics['collection_count']}å€‹ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³")
    print(f"å¿œç­”æ™‚é–“: {metrics['response_time_ms']}ms")
else:
    print(f"æ¥ç¶šå¤±æ•—: {message}")
```

### ä¾‹2: ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ä½œæˆã¨ãƒ‡ãƒ¼ã‚¿ç™»éŒ²

```python
from qdrant_client_wrapper import (
    create_qdrant_client,
    create_or_recreate_collection,
    load_csv_for_qdrant,
    build_inputs_for_embedding,
    embed_texts,
    build_points,
    upsert_points
)

# ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä½œæˆ
client = create_qdrant_client()

# ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ä½œæˆï¼ˆæ—¢å­˜ã‚’å‰Šé™¤ã—ã¦å†ä½œæˆï¼‰
create_or_recreate_collection(client, "qa_corpus", recreate=True)

# CSVãƒ­ãƒ¼ãƒ‰
df = load_csv_for_qdrant("qa_data.csv", limit=100)

# åŸ‹ã‚è¾¼ã¿å…¥åŠ›æ§‹ç¯‰
inputs = build_inputs_for_embedding(df, include_answer=True)

# åŸ‹ã‚è¾¼ã¿ç”Ÿæˆ
vectors = embed_texts(inputs)

# ãƒã‚¤ãƒ³ãƒˆæ§‹ç¯‰
points = build_points(df, vectors, domain="qa", source_file="qa_data.csv")

# ã‚¢ãƒƒãƒ—ã‚µãƒ¼ãƒˆ
count = upsert_points(client, "qa_corpus", points)
print(f"{count}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã—ã¾ã—ãŸ")
```

### ä¾‹3: æ¤œç´¢

```python
from qdrant_client_wrapper import (
    create_qdrant_client,
    embed_query,
    search_collection
)

client = create_qdrant_client()

# ã‚¯ã‚¨ãƒªã‚’åŸ‹ã‚è¾¼ã¿
query = "RAGã¨ã¯ä½•ã§ã™ã‹ï¼Ÿ"
query_vector = embed_query(query)

# æ¤œç´¢
results = search_collection(client, "qa_corpus", query_vector, limit=5)

for r in results:
    print(f"Score: {r['score']:.3f}")
    print(f"Q: {r['payload']['question']}")
    print(f"A: {r['payload']['answer']}")
    print("---")
```

### ä¾‹4: ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ä¸€è¦§å–å¾—

```python
from qdrant_client_wrapper import create_qdrant_client, QdrantDataFetcher

client = create_qdrant_client()
fetcher = QdrantDataFetcher(client)

# ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ä¸€è¦§
df_collections = fetcher.fetch_collections()
print(df_collections)

# ç‰¹å®šã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒã‚¤ãƒ³ãƒˆå–å¾—
df_points = fetcher.fetch_collection_points("qa_corpus", limit=50)
print(df_points)
```

### ä¾‹5: å…¨ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å‰Šé™¤ï¼ˆé™¤å¤–æŒ‡å®šï¼‰

```python
from qdrant_client_wrapper import create_qdrant_client, delete_all_collections

client = create_qdrant_client()

# "qa_corpus" ã‚’é™¤ã„ã¦å…¨å‰Šé™¤
deleted = delete_all_collections(client, excluded=["qa_corpus"])
print(f"{deleted}å€‹ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ã—ã¾ã—ãŸ")
```

---

## å¾Œæ–¹äº’æ›æ€§ã‚¨ã‚¤ãƒªã‚¢ã‚¹ (L836-841)

æ—§åç§°ã§ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’ã‚µãƒãƒ¼ãƒˆã€‚

| æ—§åç§° | æ–°åç§° |
|--------|--------|
| `embed_texts_for_qdrant` | `embed_texts` |
| `create_or_recreate_collection_for_qdrant` | `create_or_recreate_collection` |
| `build_points_for_qdrant` | `build_points` |
| `upsert_points_to_qdrant` | `upsert_points` |
| `embed_query_for_search` | `embed_query` |

---

## ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆä¸€è¦§

```python
__all__ = [
    # å®šæ•°
    "QDRANT_CONFIG",
    "DEFAULT_EMBEDDING_MODEL",
    "DEFAULT_VECTOR_SIZE",
    "COLLECTION_EMBEDDINGS",
    "COLLECTION_CSV_MAPPING",

    # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    "batched",

    # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ»ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
    "QdrantHealthChecker",
    "create_qdrant_client",

    # ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†
    "get_collection_stats",
    "get_all_collections",
    "delete_all_collections",
    "create_or_recreate_collection",

    # ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    "load_csv_for_qdrant",
    "build_inputs_for_embedding",

    # åŸ‹ã‚è¾¼ã¿
    "embed_texts",
    "embed_query",

    # ãƒã‚¤ãƒ³ãƒˆæ“ä½œ
    "build_points",
    "upsert_points",

    # ãƒ‡ãƒ¼ã‚¿å–å¾—
    "QdrantDataFetcher",

    # æ¤œç´¢
    "search_collection",

    # å¾Œæ–¹äº’æ›æ€§ã‚¨ã‚¤ãƒªã‚¢ã‚¹
    "embed_texts_for_qdrant",
    "create_or_recreate_collection_for_qdrant",
    "build_points_for_qdrant",
    "upsert_points_to_qdrant",
    "embed_query_for_search",
]
```

---

## ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

```python
import os
import logging
import socket
import time
import traceback
from typing import Dict, List, Optional, Any, Tuple, Iterable
from datetime import datetime, timezone

import pandas as pd
import tiktoken
from openai import OpenAI
from qdrant_client import QdrantClient
from qdrant_client.http import models
from qdrant_client.http.exceptions import UnexpectedResponse
```

---

## æ³¨æ„äº‹é …

1. **OpenAI APIã‚­ãƒ¼**: åŸ‹ã‚è¾¼ã¿ç”Ÿæˆã«ã¯ `OPENAI_API_KEY` ç’°å¢ƒå¤‰æ•°ãŒå¿…é ˆ
2. **Qdrantã‚µãƒ¼ãƒãƒ¼**: äº‹å‰ã«èµ·å‹•ãŒå¿…è¦ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: localhost:6333ï¼‰
3. **ãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™**: 1ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚ãŸã‚Šæœ€å¤§8000ãƒˆãƒ¼ã‚¯ãƒ³
4. **ãƒãƒƒãƒã‚µã‚¤ã‚º**: åŸ‹ã‚è¾¼ã¿128ã€ã‚¢ãƒƒãƒ—ã‚µãƒ¼ãƒˆ128ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
5. **ãƒ™ã‚¯ãƒˆãƒ«æ¬¡å…ƒ**: `text-embedding-3-small` ã¯1536æ¬¡å…ƒ

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ1: æ¥ç¶šã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: "Connection refused (port closed)"

**è§£æ±ºç­–**:
```bash
docker-compose -f docker-compose/docker-compose.yml up -d
```

### å•é¡Œ2: ç©ºæ–‡å­—åˆ—ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: åŸ‹ã‚è¾¼ã¿ç”Ÿæˆæ™‚ã®ã‚¨ãƒ©ãƒ¼

**è§£æ±ºç­–**: `embed_texts()` ã¯ç©ºæ–‡å­—åˆ—ã‚’è‡ªå‹•ã§ãƒ€ãƒŸãƒ¼ãƒ™ã‚¯ãƒˆãƒ«ã«ç½®æ›

### å•é¡Œ3: ãƒˆãƒ¼ã‚¯ãƒ³è¶…é

**ç—‡çŠ¶**: "Single text ... exceeds MAX_TOKENS_PER_REQUEST"

**è§£æ±ºç­–**: ãƒ†ã‚­ã‚¹ãƒˆã‚’åˆ†å‰²ã—ã¦å‡¦ç†

---

## ã¾ã¨ã‚

qdrant_client_wrapper.pyã¯ã€Qdrantæ“ä½œã‚’ä¸€å…ƒç®¡ç†ã™ã‚‹ãƒ©ãƒƒãƒ‘ãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ã€‚

### ãƒ©ãƒƒãƒ”ãƒ³ã‚°ã®åˆ©ç‚¹

1. **è¨­å®šã®ä¸€å…ƒç®¡ç†**: `config.py` ã‹ã‚‰è¨­å®šã‚’èª­ã¿è¾¼ã¿
2. **å®‰å…¨ãªæ¥ç¶š**: ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ä»˜ãã®æ¥ç¶šç¢ºèª
3. **ãƒãƒƒãƒå‡¦ç†**: åŸ‹ã‚è¾¼ã¿ãƒ»ã‚¢ãƒƒãƒ—ã‚µãƒ¼ãƒˆã®è‡ªå‹•ãƒãƒƒãƒå‡¦ç†
4. **ãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™ç®¡ç†**: OpenAI API ã®åˆ¶é™ã‚’è‡ªå‹•ç®¡ç†
5. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ç©ºæ–‡å­—åˆ—ã€å­˜åœ¨ã—ãªã„ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®å‡¦ç†
6. **DataFrameå¤‰æ›**: Qdrantçµæœã‚’pandas DataFrameã«å¤‰æ›

### æ¨å¥¨ç”¨é€”

- Q/Aãƒšã‚¢ã®ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç™»éŒ²
- RAGã‚·ã‚¹ãƒ†ãƒ ã®æ¤œç´¢ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†ãƒ»ç›£è¦–

---

ä½œæˆæ—¥: 2025-11-27
ä½œæˆè€…: OpenAI RAG Q/A JP Development Team