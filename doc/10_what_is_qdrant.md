# Qdrant ã¨ RAG ã‚·ã‚¹ãƒ†ãƒ  æŠ€è¡“è§£èª¬æ›¸

**ä½œæˆæ—¥:** 2025/12/05
**å¯¾è±¡èª­è€…:** RAGã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºè€…ã€AIã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢
**å‰æçŸ¥è­˜:** PythonåŸºç¤ã€æ©Ÿæ¢°å­¦ç¿’ã®åŸºæœ¬æ¦‚å¿µ

---

## ç›®æ¬¡

1. [ã¯ã˜ã‚ã«ï¼šãªãœãƒ™ã‚¯ãƒˆãƒ«DBãŒå¿…è¦ã‹](#1-ã¯ã˜ã‚ã«ãªãœãƒ™ã‚¯ãƒˆãƒ«dbãŒå¿…è¦ã‹)
2. [Qdrantã¨ã¯](#2-qdrantã¨ã¯)
3. [RAGã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#3-ragã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
    *   [3.6 RAGã®ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ã«ãŠã‘ã‚‹é¡ä¼¼åº¦ã®å›³ç¤ºã¨èª¬æ˜](#3-6-ragã®ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ã«ãŠã‘ã‚‹é¡ä¼¼åº¦ã®å›³ç¤ºã¨èª¬æ˜)
4. [Qdrantã®ä¸»è¦æ©Ÿèƒ½](#4-qdrantã®ä¸»è¦æ©Ÿèƒ½)
5. [ä»–ã®ãƒ™ã‚¯ãƒˆãƒ«DBã¨ã®æ¯”è¼ƒ](#5-ä»–ã®ãƒ™ã‚¯ãƒˆãƒ«dbã¨ã®æ¯”è¼ƒ)
6. [å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³](#6-å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³)
7. [ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](#7-ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹)
8. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#8-ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## 1. ã¯ã˜ã‚ã«ï¼šãªãœãƒ™ã‚¯ãƒˆãƒ«DBãŒå¿…è¦ã‹

### 1.1 å¾“æ¥ã®æ¤œç´¢ã®é™ç•Œ

å¾“æ¥ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ï¼ˆå…¨æ–‡æ¤œç´¢ï¼‰ã«ã¯æ ¹æœ¬çš„ãªé™ç•ŒãŒã‚ã‚Šã¾ã™ã€‚

```
ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã®å•é¡Œã€‘

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•: ã€ŒçŠ¬ã®é¤Œã‚„ã‚Šã®é »åº¦ã¯ï¼Ÿã€

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆA: ã€Œãƒ¯ãƒ³ã¡ã‚ƒã‚“ã«ã¯1æ—¥2å›ã”é£¯ã‚’ã‚ã’ã¾ã—ã‚‡ã†ã€
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆB: ã€ŒçŠ¬ã¨ã„ã†å˜èªãŒå«ã¾ã‚Œã‚‹ç„¡é–¢ä¿‚ãªæ–‡æ›¸ã€

â†’ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€ŒçŠ¬ã€ã§æ¤œç´¢ã™ã‚‹ã¨ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆBãŒãƒ’ãƒƒãƒˆã—ã€
  ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆAï¼ˆæ­£è§£ï¼‰ã¯ã€ŒçŠ¬ã€ã¨ã„ã†å˜èªãŒãªã„ãŸã‚ãƒ’ãƒƒãƒˆã—ãªã„
```

### 1.2 ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ã®ç™»å ´

**ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ï¼ˆæ„å‘³æ¤œç´¢ï¼‰** ã¯ã€å˜èªã®ä¸€è‡´ã§ã¯ãªãã€Œæ„å‘³ã®è¿‘ã•ã€ã§æ¤œç´¢ã—ã¾ã™ã€‚

```
ã€ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ã€‘

ã€ŒçŠ¬ã®é¤Œã‚„ã‚Šã®é »åº¦ã¯ï¼Ÿã€ â†’ ãƒ™ã‚¯ãƒˆãƒ«åŒ– â†’ [0.23, -0.45, 0.12, ...]

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆA: ã€Œãƒ¯ãƒ³ã¡ã‚ƒã‚“ã«ã¯1æ—¥2å›...ã€ â†’ [0.21, -0.43, 0.15, ...]
                                            â†‘ æ„å‘³ãŒè¿‘ã„ = é¡ä¼¼åº¦é«˜

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆB: ã€ŒçŠ¬ã¨ã„ã†å˜èªãŒ...ã€ â†’ [0.78, 0.32, -0.55, ...]
                                      â†‘ æ„å‘³ãŒé ã„ = é¡ä¼¼åº¦ä½
```

### 1.3 ãƒ™ã‚¯ãƒˆãƒ«DBã®å½¹å‰²

**ãƒ™ã‚¯ãƒˆãƒ«DB**ã¯ã€ã“ã®ã€Œãƒ™ã‚¯ãƒˆãƒ«ï¼ˆæ•°å€¤é…åˆ—ï¼‰ã€ã‚’åŠ¹ç‡çš„ã«ä¿å­˜ãƒ»æ¤œç´¢ã™ã‚‹ãŸã‚ã®å°‚ç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ãƒ™ã‚¯ãƒˆãƒ«DBã®å½¹å‰²                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. ãƒ™ã‚¯ãƒˆãƒ«ã®ä¿å­˜ï¼ˆæ•°ç™¾ä¸‡ã€œæ•°åå„„ä»¶ï¼‰                      â”‚
â”‚  2. é¡ä¼¼åº¦æ¤œç´¢ï¼ˆæœ€è¿‘å‚æ¢ç´¢ / ANNï¼‰                        â”‚
â”‚  3. ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«ã‚ˆã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°                         â”‚
â”‚  4. ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªåˆ†æ•£å‡¦ç†                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Qdrantã¨ã¯

### 2.1 æ¦‚è¦

**Qdrant**ï¼ˆã‚¯ã‚¢ãƒ‰ãƒ©ãƒ³ãƒˆï¼‰ã¯ã€Rustè¨€èªã§é–‹ç™ºã•ã‚ŒãŸé«˜æ€§èƒ½ãªã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã§ã™ã€‚


| é …ç›®             | å†…å®¹                            |
| ---------------- | ------------------------------- |
| **é–‹ç™ºå…ƒ**       | Qdrant Solutions GmbHï¼ˆãƒ‰ã‚¤ãƒ„ï¼‰ |
| **ãƒ©ã‚¤ã‚»ãƒ³ã‚¹**   | Apache 2.0ï¼ˆã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ï¼‰    |
| **é–‹ç™ºè¨€èª**     | Rust                            |
| **åˆç‰ˆãƒªãƒªãƒ¼ã‚¹** | 2021å¹´                          |
| **å…¬å¼ã‚µã‚¤ãƒˆ**   | https://qdrant.tech             |

### 2.2 åå‰ã®ç”±æ¥

ã€ŒQdrantã€ã¯ã€ŒQuadrantï¼ˆè±¡é™ï¼‰ã€ã«ç”±æ¥ã—ã€å¤šæ¬¡å…ƒç©ºé–“ã§ã®ãƒ‡ãƒ¼ã‚¿æ¤œç´¢ã‚’è±¡å¾´ã—ã¦ã„ã¾ã™ã€‚

### 2.3 ä¸»ãªç‰¹å¾´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Qdrant ã®ç‰¹å¾´                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸš€ é«˜æ€§èƒ½     : Rustè£½ã§é«˜é€Ÿã€ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ãŒè‰¯ã„          â”‚
â”‚  ğŸ“¦ ã‚·ãƒ³ãƒ—ãƒ«   : Dockerä¸€ç™ºã§èµ·å‹•ã€REST/gRPC API        â”‚
â”‚  ğŸ” å¤šæ©Ÿèƒ½     : ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã€ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã€æ¨å¥¨æ©Ÿèƒ½    â”‚
â”‚  ğŸŒ ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«: åˆ†æ•£ã‚¯ãƒ©ã‚¹ã‚¿å¯¾å¿œ                       â”‚
â”‚  ğŸ’¾ æ°¸ç¶šåŒ–     : ãƒ‡ã‚£ã‚¹ã‚¯ä¿å­˜ã€ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ãƒªã‚«ãƒãƒª        â”‚
â”‚  ğŸ†“ ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹: ç„¡æ–™ã§å•†ç”¨åˆ©ç”¨å¯èƒ½                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Qdrant Server                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ REST API    â”‚  â”‚ gRPC API    â”‚  â”‚ Web UI      â”‚     â”‚
â”‚  â”‚ :6333       â”‚  â”‚ :6334       â”‚  â”‚ :6333/dashboardâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚                â”‚                â”‚             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                          â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Query Processing Engine             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ Filter  â”‚  â”‚ ANN     â”‚  â”‚ Payload Search  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ Engine  â”‚  â”‚ Index   â”‚  â”‚                 â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                              â”‚
â”‚                          â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                Storage Layer                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Collections  â”‚  â”‚ Segments (HNSW Index)    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚              â”‚  â”‚                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ - vectors    â”‚  â”‚ - Memory-mapped files    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ - payloads   â”‚  â”‚ - Write-ahead log (WAL)  â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. RAGã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 3.1 RAGã¨ã¯

**RAGï¼ˆRetrieval-Augmented Generationï¼‰** ã¯ã€LLMã®å›ç­”ç”Ÿæˆã‚’å¤–éƒ¨çŸ¥è­˜ã§è£œå¼·ã™ã‚‹æ‰‹æ³•ã§ã™ã€‚

```
RAG = Retrievalï¼ˆæ¤œç´¢ï¼‰ + Augmentedï¼ˆè£œå¼·ã•ã‚ŒãŸï¼‰ + Generationï¼ˆç”Ÿæˆï¼‰
```

### 3.2 RAGãŒè§£æ±ºã™ã‚‹å•é¡Œ


| å•é¡Œ                 | RAGã«ã‚ˆã‚‹è§£æ±º                  |
| -------------------- | ------------------------------ |
| LLMã®çŸ¥è­˜ãŒå¤ã„      | æœ€æ–°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ¤œç´¢ã—ã¦å‚ç…§ |
| ãƒãƒ«ã‚·ãƒãƒ¼ã‚·ãƒ§ãƒ³     | æ ¹æ‹ ã¨ãªã‚‹ã‚½ãƒ¼ã‚¹ã‚’æ˜ç¤º         |
| ç¤¾å†…æƒ…å ±ã‚’çŸ¥ã‚‰ãªã„   | ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒŠãƒ¬ãƒƒã‚¸ã‚’æ¤œç´¢     |
| ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆé•·ã®åˆ¶é™ | å¿…è¦ãªæƒ…å ±ã ã‘ã‚’æŠ½å‡ºã—ã¦æ¸¡ã™   |

### 3.3 RAGã‚·ã‚¹ãƒ†ãƒ å…¨ä½“åƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        RAG System Architecture                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚     â”‚              Indexing Pipeline                   â”‚
â”‚  Documents  â”‚â”€â”€â”€â”€â–¶â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  (åŸæ–‡)     â”‚     â”‚  â”‚ Chunker â”‚â”€â–¶â”‚Embeddingâ”‚â”€â–¶â”‚   Vector DB     â”‚  â”‚
â”‚             â”‚     â”‚  â”‚ åˆ†å‰²    â”‚  â”‚ Model   â”‚  â”‚   (Qdrant)      â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                          â”‚
                                                          â”‚ ä¿å­˜
                                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚     â”‚              Query Pipeline                      â”‚
â”‚    User     â”‚â”€â”€â”€â”€â–¶â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   Query     â”‚     â”‚  â”‚Embeddingâ”‚â”€â–¶â”‚ Search  â”‚â”€â–¶â”‚   Retrieved     â”‚  â”‚
â”‚             â”‚     â”‚  â”‚ Model   â”‚  â”‚ Qdrant  â”‚  â”‚   Contexts      â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                          â”‚
                                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚     â”‚              Generation Pipeline                 â”‚
â”‚   Answer    â”‚â—€â”€â”€â”€â”€â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚             â”‚     â”‚  â”‚  LLM (Gemini/GPT/Claude)                    â”‚â”‚
â”‚             â”‚     â”‚  â”‚                                             â”‚â”‚
â”‚             â”‚     â”‚  â”‚  Prompt = Query + Retrieved Contexts        â”‚â”‚
â”‚             â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 Qdrantã®ä½ç½®ã¥ã‘ï¼ˆè©³ç´°ï¼‰

RAGã‚·ã‚¹ãƒ†ãƒ ã«ãŠã‘ã‚‹Qdrantã®å½¹å‰²ã‚’è©³ç´°ã«ç¤ºã—ã¾ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RAG ã«ãŠã‘ã‚‹ Qdrant ã®å½¹å‰²                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€å½¹å‰²1: ãƒ™ã‚¯ãƒˆãƒ«ã®æ°¸ç¶šåŒ–ã€‘
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Embedding Model                    Qdrant                       â”‚
  â”‚  (text-embedding-004)               Collection                   â”‚
  â”‚                                                                  â”‚
  â”‚  "Pythonã®å¤‰æ•°å®£è¨€"  â”€â”€â”€â–¶  [0.12, -0.34, ...]  â”€â”€â”€â–¶  Point #1   â”‚
  â”‚  "foræ–‡ã®æ›¸ãæ–¹"     â”€â”€â”€â–¶  [0.08, -0.29, ...]  â”€â”€â”€â–¶  Point #2   â”‚
  â”‚  "ã‚¯ãƒ©ã‚¹ã®å®šç¾©"      â”€â”€â”€â–¶  [0.15, -0.41, ...]  â”€â”€â”€â–¶  Point #3   â”‚
  â”‚                                     â†“                            â”‚
  â”‚                              æ°¸ç¶šåŒ–ï¼ˆãƒ‡ã‚£ã‚¹ã‚¯ä¿å­˜ï¼‰               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€å½¹å‰²2: é¡ä¼¼åº¦æ¤œç´¢ï¼ˆANNï¼‰ã€‘
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Query: "å¤‰æ•°ã®ä½œã‚Šæ–¹"                                           â”‚
  â”‚                                                                  â”‚
  â”‚       [0.11, -0.32, ...]  â—€â”€â”€ ã‚¯ã‚¨ãƒªãƒ™ã‚¯ãƒˆãƒ«                     â”‚
  â”‚              â”‚                                                   â”‚
  â”‚              â–¼                                                   â”‚
  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
  â”‚       â”‚     HNSW Indexï¼ˆè¿‘ä¼¼æœ€è¿‘å‚æ¢ç´¢ï¼‰            â”‚           â”‚
  â”‚       â”‚                                             â”‚           â”‚
  â”‚       â”‚   Point #1: è·é›¢ 0.05 âœ“ (æœ€ã‚‚è¿‘ã„)         â”‚           â”‚
  â”‚       â”‚   Point #2: è·é›¢ 0.42                       â”‚           â”‚
  â”‚       â”‚   Point #3: è·é›¢ 0.38                       â”‚           â”‚
  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
  â”‚              â”‚                                                   â”‚
  â”‚              â–¼                                                   â”‚
  â”‚       Result: Point #1 (Score: 0.95)                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€å½¹å‰²3: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã€‘
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Qdrant Payloadï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼‰                                    â”‚
  â”‚                                                                  â”‚
  â”‚  Point #1: { "category": "python", "difficulty": "beginner" }   â”‚
  â”‚  Point #2: { "category": "python", "difficulty": "advanced" }   â”‚
  â”‚  Point #3: { "category": "java",   "difficulty": "beginner" }   â”‚
  â”‚                                                                  â”‚
  â”‚  Query: "å¤‰æ•°ã®ä½œã‚Šæ–¹" + Filter: category="python"              â”‚
  â”‚                                                                  â”‚
  â”‚  â†’ Point #1, #2 ã®ã¿ãŒæ¤œç´¢å¯¾è±¡ï¼ˆ#3ã¯é™¤å¤–ï¼‰                      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.5 ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ï¼ˆæ™‚ç³»åˆ—ï¼‰

```
ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆæ™‚ã€‘

Step 1: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæº–å‚™
  docs/manual.pdf â”€â”€â–¶ ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º â”€â”€â–¶ "ç¬¬1ç«  æ¦‚è¦..."

Step 2: ãƒãƒ£ãƒ³ã‚¯åˆ†å‰²
  "ç¬¬1ç«  æ¦‚è¦..." â”€â”€â–¶ Chunker â”€â”€â–¶ ["ç¬¬1ç«  æ¦‚è¦", "1.1 ç›®çš„", ...]

Step 3: åŸ‹ã‚è¾¼ã¿ç”Ÿæˆ
  ["ç¬¬1ç«  æ¦‚è¦", ...] â”€â”€â–¶ Gemini Embedding â”€â”€â–¶ [[0.1, -0.2, ...], ...]

Step 4: Qdrantã«ä¿å­˜
  [[0.1, -0.2, ...], ...] â”€â”€â–¶ Qdrant.upsert() â”€â”€â–¶ Collection "manuals"


ã€æ¤œç´¢æ™‚ã€‘

Step 1: ã‚¯ã‚¨ãƒªåŸ‹ã‚è¾¼ã¿
  "æ¦‚è¦ã‚’æ•™ãˆã¦" â”€â”€â–¶ Gemini Embedding â”€â”€â–¶ [0.12, -0.18, ...]

Step 2: Qdrantæ¤œç´¢
  [0.12, -0.18, ...] â”€â”€â–¶ Qdrant.search() â”€â”€â–¶ [Point #1 (score: 0.92), ...]

Step 3: ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå–å¾—
  Point #1 â”€â”€â–¶ payload.text â”€â”€â–¶ "ç¬¬1ç«  æ¦‚è¦: æœ¬ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã¯..."

Step 4: LLMç”Ÿæˆ
  Prompt = "è³ªå•: æ¦‚è¦ã‚’æ•™ãˆã¦\nå‚è€ƒ: ç¬¬1ç«  æ¦‚è¦: æœ¬ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã¯..."
       â”€â”€â–¶ Gemini â”€â”€â–¶ "ã“ã®ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã®æ¦‚è¦ã¯..."
```

---

### 3.6 RAGã®ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ã«ãŠã‘ã‚‹é¡ä¼¼åº¦ã®å›³ç¤ºã¨èª¬æ˜

RAGï¼ˆRetrieval-Augmented Generationï¼‰ã«ãŠã‘ã‚‹ã€Œãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ã€ã®æ ¸å¿ƒã§ã‚ã‚‹ã€ãƒ™ã‚¯ãƒˆãƒ«Aï¼ˆè³ªå•ï¼‰ã¨ãƒ™ã‚¯ãƒˆãƒ«Bï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰ã®é¡ä¼¼åº¦ã®æ¦‚å¿µã‚’å›³è§£ã¨è§£èª¬ã§ç¤ºã—ã¾ã™ã€‚

RAGã§ã¯ã€æ–‡ç« ã®ã€Œæ„å‘³ã€ã‚’æ•°å€¤ã®åˆ—ï¼ˆãƒ™ã‚¯ãƒˆãƒ«ï¼‰ã«å¤‰æ›ã—ã€ç©ºé–“ä¸Šã®ã€Œå‘ãã€ã®è¿‘ã•ã§é¡ä¼¼åº¦ã‚’åˆ¤å®šã—ã¾ã™ã€‚

#### 1. ãƒ™ã‚¯ãƒˆãƒ«é¡ä¼¼åº¦ã®å¹¾ä½•å­¦çš„ã‚¤ãƒ¡ãƒ¼ã‚¸

æœ€ã‚‚ä¸€èˆ¬çš„ã«ä½¿ã‚ã‚Œã‚‹ã€Œã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦ï¼ˆCosine Similarityï¼‰ã€ã§ã¯ã€ãƒ™ã‚¯ãƒˆãƒ«ã®é•·ã•ï¼ˆæ–‡ç« ã®é•·ã•ï¼‰ã§ã¯ãªãã€**ã€Œè§’åº¦ï¼ˆ$\theta$ï¼‰ã€ã®è¿‘ã•ï¼ˆæ„å‘³ã®æ–¹å‘ï¼‰** ãŒé‡è¦ã§ã™ã€‚

ä»¥ä¸‹ã®å›³ã¯ã€å¤šæ¬¡å…ƒã®æ„å‘³ç©ºé–“ã‚’ç°¡ç•¥åŒ–ã—ã¦è¡¨ç¾ã—ãŸã‚‚ã®ã§ã™ã€‚

```text
       [æ„å‘³ã®æ¬¡å…ƒ Y]
             ^
             |
             |   ãƒ™ã‚¯ãƒˆãƒ« A (è³ªå•)
             |   ã€ŒQdrantã®ä½¿ã„æ–¹ã€
             |       /
             |      /
             |     /
             |    /  Î¸1 (è§’åº¦ å°) â” ã€é¡ä¼¼åº¦ï¼šé«˜ (ã€œ0.9)ã€‘
             |   / . . . . ãƒ™ã‚¯ãƒˆãƒ« B (é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ)
             |  //         ã€ŒQdrant æŠ€è¡“è§£èª¬æ›¸ã€
             | //
             |//
(åŸç‚¹ 0,0)   O------------------------------> [æ„å‘³ã®æ¬¡å…ƒ X]
             \
              \
               \  Î¸2 (è§’åº¦ å¤§) â” ã€é¡ä¼¼åº¦ï¼šä½ (ã€œ0.1)ã€‘
                \
                 \
                  \ ãƒ™ã‚¯ãƒˆãƒ« C (ç„¡é–¢ä¿‚ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ)
                    ã€Œç¾å‘³ã—ã„ã‚«ãƒ¬ãƒ¼ã®ä½œã‚Šæ–¹ã€
```

**ã€å›³ã®è§£èª¬ã€‘**

*   **ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆçŸ¢å°ï¼‰**: æ–‡ç« ã®æ„å‘³ã‚’è¡¨ã™æ•°å€¤ã®åˆ—ã§ã™ã€‚
*   **è§’åº¦ï¼ˆÎ¸ï¼‰**: çŸ¢å°åŒå£«ã®é–‹ãå…·åˆã§ã™ã€‚ã“ã‚ŒãŒã€Œæ„å‘³ã®é¡ä¼¼åº¦ã€ã‚’è¡¨ã—ã¾ã™ã€‚
    *   **Î¸1 (Aã¨B)**: è§’åº¦ãŒç‹­ã„ãŸã‚ã€æ„å‘³ãŒè¿‘ãã€æ¤œç´¢çµæœã¨ã—ã¦ãƒ’ãƒƒãƒˆã—ã¾ã™ã€‚
    *   **Î¸2 (Aã¨C)**: è§’åº¦ãŒåºƒã„ãŸã‚ã€æ„å‘³ãŒé ãã€ç„¡é–¢ä¿‚ã¨åˆ¤æ–­ã•ã‚Œã¾ã™ã€‚

**ã€ãªãœã€Œé•·ã•ã€ã§ã¯ãªãã€Œè§’åº¦ã€ãªã®ã‹ï¼Ÿã€‘**

ã€ŒQdrantã¨ã¯ï¼Ÿã€ã¨ã„ã†çŸ­ã„è³ªå•ã¨ã€ã€ŒQdrantã¯Rustè£½ã®â€¦ã€ã¨ã„ã†é•·ã„å›ç­”ã¯ã€æ–‡ç« ã®é•·ã•ï¼ˆãƒ™ã‚¯ãƒˆãƒ«ã®é•·ã•ï¼‰ã¯å¤§ããç•°ãªã‚Šã¾ã™ãŒã€**ãƒˆãƒ”ãƒƒã‚¯ã®æ–¹å‘ï¼ˆãƒ™ã‚¯ãƒˆãƒ«ã®å‘ãï¼‰** ã¯ä¸€è‡´ã—ã¾ã™ã€‚ãã®ãŸã‚ã€è·é›¢ã§ã¯ãªãè§’åº¦ã‚’è¦‹ã‚‹ã“ã¨ã§ã€é•·ã•ãŒé•ã£ã¦ã‚‚æ„å‘³ãŒåˆã†ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ­£ç¢ºã«è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

#### 2. RAGã«ãŠã‘ã‚‹å‡¦ç†ãƒ•ãƒ­ãƒ¼å›³ (Mermaid)

ãƒ—ãƒ­ã‚°ãƒ©ãƒ çš„ãªè¦–ç‚¹ã§ã®æ¯”è¼ƒãƒ—ãƒ­ã‚»ã‚¹ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```mermaid
flowchart LR
    subgraph Query_Side ["è³ªå•å´"]
        Q["ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•"] -->|"Embeddingãƒ¢ãƒ‡ãƒ«"| VA("ãƒ™ã‚¯ãƒˆãƒ« A")
    end

    subgraph Knowledge_Base ["çŸ¥è­˜ãƒ™ãƒ¼ã‚¹å´"]
        D["ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ"] -->|"Embeddingãƒ¢ãƒ‡ãƒ«"| VB("ãƒ™ã‚¯ãƒˆãƒ« B")
    end

    VA -->|"æ¯”è¼ƒæ¼”ç®—"| Sim{"é¡ä¼¼åº¦è¨ˆç®—"}
    VB -->|"æ¯”è¼ƒæ¼”ç®—"| Sim

    Sim -->|"Cosé¡ä¼¼åº¦ç®—å‡º"| Score["ã‚¹ã‚³ã‚¢: 0.0 ã€œ 1.0"]
    
    Score -- "ã‚¹ã‚³ã‚¢ãŒé«˜ã„" --> Match["æ¤œç´¢çµæœã¨ã—ã¦æ¡ç”¨"]
    Score -- "ã‚¹ã‚³ã‚¢ãŒä½ã„" --> Ignore["ç„¡è¦–"]

    style VA fill:#000,stroke:#333,stroke-width:2px,color:#fff
    style VB fill:#000,stroke:#333,stroke-width:2px,color:#fff
    style Sim fill:#000,stroke:#333,stroke-width:2px,color:#fff
```

#### 3. è§£èª¬ï¼šãªãœã“ã‚Œã§ã€Œæ„å‘³ã€ãŒã‚ã‹ã‚‹ã®ã‹ï¼Ÿ

ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã¯è¨€è‘‰ã®æ„å‘³ãã®ã‚‚ã®ã‚’ç†è§£ã—ã¦ã„ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€Embeddingï¼ˆåŸ‹ã‚è¾¼ã¿ï¼‰ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã£ã¦ã€æ„å‘³ãŒè¿‘ã„è¨€è‘‰ã¯**å¤šæ¬¡å…ƒç©ºé–“ä¸Šã®è¿‘ã„å ´æ‰€ï¼ˆåŒã˜ã‚ˆã†ãªæ–¹å‘ï¼‰**ã«é…ç½®ã•ã‚Œã‚‹ã‚ˆã†ã«å­¦ç¿’ã•ã‚Œã¦ã„ã¾ã™ã€‚

*   **ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦ ($Cosine Similarity$):**
    *   ãƒ™ã‚¯ãƒˆãƒ«åŒå£«ã®ãªã™è§’ã®ã‚³ã‚µã‚¤ãƒ³å€¤ã‚’ã¨ã‚Šã¾ã™ã€‚
    *   **1.0**: å…¨ãåŒã˜å‘ãï¼ˆå®Œå…¨ã«ä¸€è‡´ï¼‰ã€‚
    *   **0.0**: ç›´è§’ï¼ˆç„¡é–¢ä¿‚ï¼‰ã€‚
    *   **-1.0**: æ­£åå¯¾ï¼ˆåå¯¾ã®æ„å‘³ï¼‰ã€‚

RAGã‚·ã‚¹ãƒ†ãƒ ï¼ˆQdrantãªã©ï¼‰ã¯ã€ã“ã®è¨ˆç®—ã‚’æ•°ç™¾ä¸‡ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«å¯¾ã—ã¦è¶…é«˜é€Ÿã«è¡Œã„ã€ã€Œãƒ™ã‚¯ãƒˆãƒ«Aï¼ˆè³ªå•ï¼‰ã¨ã‚‚ã£ã¨ã‚‚è§’åº¦ãŒè¿‘ã„ãƒ™ã‚¯ãƒˆãƒ«B, C, D...ã€ã‚’è¦‹ã¤ã‘å‡ºã—ã¦ã„ã¾ã™ã€‚

---

## 4. Qdrantã®ä¸»è¦æ©Ÿèƒ½

### 4.1 Collectionï¼ˆã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼‰

ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€ãƒ™ã‚¯ãƒˆãƒ«ã¨ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’æ ¼ç´ã™ã‚‹è«–ç†çš„ãªå˜ä½ã§ã™ã€‚

```python
from qdrant_client import QdrantClient
from qdrant_client.models import Distance, VectorParams

client = QdrantClient(host="localhost", port=6333)

# ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ä½œæˆ
client.create_collection(
    collection_name="documents",
    vectors_config=VectorParams(
        size=768,              # ãƒ™ã‚¯ãƒˆãƒ«æ¬¡å…ƒæ•°ï¼ˆGemini: 768ï¼‰
        distance=Distance.COSINE  # é¡ä¼¼åº¦è¨ˆç®—æ–¹æ³•
    )
)
```

### 4.2 Pointï¼ˆãƒã‚¤ãƒ³ãƒˆï¼‰

ãƒã‚¤ãƒ³ãƒˆã¯ã€ãƒ™ã‚¯ãƒˆãƒ« + ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼‰ã®çµ„ã¿åˆã‚ã›ã§ã™ã€‚

```python
from qdrant_client.models import PointStruct

# ãƒã‚¤ãƒ³ãƒˆè¿½åŠ 
client.upsert(
    collection_name="documents",
    points=[
        PointStruct(
            id=1,
            vector=[0.1, -0.2, 0.3, ...],  # 768æ¬¡å…ƒ
            payload={
                "text": "Pythonã®å¤‰æ•°ã¯å‹•çš„å‹ä»˜ã‘ã§ã™",
                "category": "python",
                "source": "manual.pdf",
                "page": 10
            }
        ),
        PointStruct(
            id=2,
            vector=[0.2, -0.1, 0.4, ...],
            payload={
                "text": "foræ–‡ã¯ç¹°ã‚Šè¿”ã—å‡¦ç†ã«ä½¿ã„ã¾ã™",
                "category": "python",
                "source": "manual.pdf",
                "page": 15
            }
        )
    ]
)
```

### 4.3 Searchï¼ˆæ¤œç´¢ï¼‰

```python
# åŸºæœ¬æ¤œç´¢
results = client.search(
    collection_name="documents",
    query_vector=[0.12, -0.18, 0.35, ...],  # ã‚¯ã‚¨ãƒªãƒ™ã‚¯ãƒˆãƒ«
    limit=5  # ä¸Šä½5ä»¶
)

for result in results:
    print(f"ID: {result.id}, Score: {result.score:.4f}")
    print(f"Text: {result.payload['text']}")
```

### 4.4 Filterï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼‰

```python
from qdrant_client.models import Filter, FieldCondition, MatchValue

# ãƒ•ã‚£ãƒ«ã‚¿ä»˜ãæ¤œç´¢
results = client.search(
    collection_name="documents",
    query_vector=query_vector,
    query_filter=Filter(
        must=[
            FieldCondition(
                key="category",
                match=MatchValue(value="python")
            )
        ]
    ),
    limit=5
)
```

### 4.5 è·é›¢è¨ˆç®—æ–¹å¼


| æ–¹å¼       | èª¬æ˜                   | ç”¨é€”                       |
| ---------- | ---------------------- | -------------------------- |
| **Cosine** | ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦ï¼ˆè§’åº¦ï¼‰ | ãƒ†ã‚­ã‚¹ãƒˆæ¤œç´¢ï¼ˆæœ€ã‚‚ä¸€èˆ¬çš„ï¼‰ |
| **Euclid** | ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰è·é›¢       | ç”»åƒã€åº§æ¨™ãƒ‡ãƒ¼ã‚¿           |
| **Dot**    | å†…ç©                   | æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ                |

```python
# Cosine: å€¤ãŒå¤§ãã„ã»ã©é¡ä¼¼ï¼ˆ0ã€œ1ï¼‰
# Euclid: å€¤ãŒå°ã•ã„ã»ã©é¡ä¼¼ï¼ˆ0ã€œâˆï¼‰
# Dot: å€¤ãŒå¤§ãã„ã»ã©é¡ä¼¼ï¼ˆ-âˆã€œâˆï¼‰
```

---

## 5. ä»–ã®ãƒ™ã‚¯ãƒˆãƒ«DBã¨ã®æ¯”è¼ƒ

### 5.1 æ¯”è¼ƒè¡¨


| é …ç›®                   | Qdrant     | Redis (VSS) | Pinecone   | Chroma     | Milvus     |
| ---------------------- | ---------- | ----------- | ---------- | ---------- | ---------- |
| **ãƒ©ã‚¤ã‚»ãƒ³ã‚¹**         | Apache 2.0 | BSD-3       | å•†ç”¨       | Apache 2.0 | Apache 2.0 |
| **é–‹ç™ºè¨€èª**           | Rust       | C           | -          | Python     | Go/C++     |
| **ãƒ‡ãƒ—ãƒ­ã‚¤**           | Self/Cloud | Self        | Cloud only | Self       | Self/Cloud |
| **ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**     | â— å¼·åŠ›    | â—‹          | â—         | â–³         | â—         |
| **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**   | â—         | â—‹          | â—         | â–³         | â—         |
| **å­¦ç¿’ã‚³ã‚¹ãƒˆ**         | ä½         | ä¸­          | ä½         | ä½         | é«˜         |
| **æ—¥æœ¬èªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ** | â–³         | â—‹          | â–³         | â–³         | â–³         |

### 5.2 Redis vs Qdrant

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ Redis ã¨ Qdrant ã‚’ä½µç”¨ã—ã¦ã„ã¾ã™ãŒã€å½¹å‰²ãŒç•°ãªã‚Šã¾ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Redis vs Qdrant ä½¿ã„åˆ†ã‘                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Redis                â”‚            Qdrant               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ã€ä¸»ãªç”¨é€”ã€‘                    â”‚  ã€ä¸»ãªç”¨é€”ã€‘                    â”‚
â”‚  ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†               â”‚  ãƒ»ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ï¼ˆãƒ¡ã‚¤ãƒ³ï¼‰        â”‚
â”‚  ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥                   â”‚  ãƒ»ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹               â”‚
â”‚  ãƒ»ä¸€æ™‚ãƒ‡ãƒ¼ã‚¿ä¿å­˜               â”‚  ãƒ»é•·æœŸãƒ‡ãƒ¼ã‚¿ä¿å­˜               â”‚
â”‚                                 â”‚                                 â”‚
â”‚  ã€ç‰¹å¾´ã€‘                       â”‚  ã€ç‰¹å¾´ã€‘                       â”‚
â”‚  ãƒ»è¶…é«˜é€Ÿï¼ˆã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªï¼‰          â”‚  ãƒ»ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ã«ç‰¹åŒ–           â”‚
â”‚  ãƒ»TTLï¼ˆæœ‰åŠ¹æœŸé™ï¼‰è¨­å®šå¯èƒ½       â”‚  ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½ãŒè±Šå¯Œ     â”‚
â”‚  ãƒ»Pub/Subæ©Ÿèƒ½                  â”‚  ãƒ»æ°¸ç¶šåŒ–ãŒå …ç‰¢                 â”‚
â”‚                                 â”‚                                 â”‚
â”‚  ã€æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®å½¹å‰²ã€‘      â”‚  ã€æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®å½¹å‰²ã€‘      â”‚
â”‚  ãƒ»ä¼šè©±å±¥æ­´ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥          â”‚  ãƒ»RAGã®ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢            â”‚
â”‚  ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ç®¡ç†            â”‚  ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¿å­˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 é¸å®šç†ç”±

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§Qdrantã‚’é¸å®šã—ãŸç†ç”±ï¼š


| ç†ç”±                  | è©³ç´°                                                       |
| --------------------- | ---------------------------------------------------------- |
| **1. ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹** | Apache 2.0ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã§å•†ç”¨åˆ©ç”¨å¯èƒ½ã€ãƒ™ãƒ³ãƒ€ãƒ¼ãƒ­ãƒƒã‚¯ã‚¤ãƒ³ãªã— |
| **2. ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œ**   | Dockerä¸€ç™ºã§èµ·å‹•ã€é–‹ç™ºç’°å¢ƒã§ã®æ¤œè¨¼ãŒå®¹æ˜“                   |
| **3. é«˜æ€§èƒ½**         | Rustè£½ã§é«˜é€Ÿã€M2 Macã§ã‚‚å¿«é©ã«å‹•ä½œ                         |
| **4. ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°** | ã‚«ãƒ†ã‚´ãƒªåˆ¥æ¤œç´¢ãªã©ã€è¤‡é›‘ãªã‚¯ã‚¨ãƒªã«å¯¾å¿œ                     |
| **5. REST API**       | ç›´æ„Ÿçš„ãªAPIã€ãƒ‡ãƒãƒƒã‚°ãŒå®¹æ˜“                                |
| **6. Web UI**         | çµ„ã¿è¾¼ã¿ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ãƒ‡ãƒ¼ã‚¿ç¢ºèªå¯èƒ½                     |

---

## 6. å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

### 6.1 åŸºæœ¬çš„ãªRAGå®Ÿè£…

```python
# rag_system.py
"""
Qdrantã‚’ä½¿ç”¨ã—ãŸåŸºæœ¬çš„ãªRAGã‚·ã‚¹ãƒ†ãƒ 
"""
import google.generativeai as genai
from qdrant_client import QdrantClient
from qdrant_client.models import Distance, VectorParams, PointStruct

class RAGSystem:
    def __init__(
        self,
        qdrant_host: str = "localhost",
        qdrant_port: int = 6333,
        collection_name: str = "knowledge_base",
        embedding_model: str = "models/text-embedding-004"
    ):
        # Qdrantã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–
        self.client = QdrantClient(host=qdrant_host, port=qdrant_port)
        self.collection_name = collection_name
        self.embedding_model = embedding_model

        # Geminiè¨­å®š
        genai.configure(api_key=os.getenv("GEMINI_API_KEY"))

    def create_collection(self, vector_size: int = 768):
        """ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ä½œæˆ"""
        self.client.recreate_collection(
            collection_name=self.collection_name,
            vectors_config=VectorParams(
                size=vector_size,
                distance=Distance.COSINE
            )
        )

    def embed_text(self, text: str) -> list:
        """ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒ™ã‚¯ãƒˆãƒ«åŒ–"""
        result = genai.embed_content(
            model=self.embedding_model,
            content=text
        )
        return result['embedding']

    def add_documents(self, documents: list[dict]):
        """
        ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¿½åŠ 
        documents: [{"id": 1, "text": "...", "metadata": {...}}, ...]
        """
        points = []
        for doc in documents:
            vector = self.embed_text(doc["text"])
            points.append(PointStruct(
                id=doc["id"],
                vector=vector,
                payload={
                    "text": doc["text"],
                    **doc.get("metadata", {})
                }
            ))

        self.client.upsert(
            collection_name=self.collection_name,
            points=points
        )

    def search(
        self,
        query: str,
        limit: int = 5,
        score_threshold: float = 0.7
    ) -> list[dict]:
        """é¡ä¼¼æ¤œç´¢"""
        query_vector = self.embed_text(query)

        results = self.client.search(
            collection_name=self.collection_name,
            query_vector=query_vector,
            limit=limit,
            score_threshold=score_threshold
        )

        return [
            {
                "id": r.id,
                "score": r.score,
                "text": r.payload.get("text", ""),
                "metadata": {k: v for k, v in r.payload.items() if k != "text"}
            }
            for r in results
        ]

    def generate_answer(self, query: str, contexts: list[str]) -> str:
        """LLMã§å›ç­”ç”Ÿæˆ"""
        model = genai.GenerativeModel("gemini-2.0-flash")

        prompt = f"""ä»¥ä¸‹ã®å‚è€ƒæƒ…å ±ã«åŸºã¥ã„ã¦è³ªå•ã«å›ç­”ã—ã¦ãã ã•ã„ã€‚
å‚è€ƒæƒ…å ±ã«ãªã„å†…å®¹ã¯ã€Œæƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€ã¨ç­”ãˆã¦ãã ã•ã„ã€‚

## å‚è€ƒæƒ…å ±
{chr(10).join(contexts)}

## è³ªå•
{query}

## å›ç­”
"""
        response = model.generate_content(prompt)
        return response.text

    def query(self, question: str) -> str:
        """RAGã‚¯ã‚¨ãƒªå®Ÿè¡Œï¼ˆæ¤œç´¢â†’ç”Ÿæˆï¼‰"""
        # 1. æ¤œç´¢
        results = self.search(question)

        if not results:
            return "ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ãŒã€é–¢é€£ã™ã‚‹æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚"

        # 2. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º
        contexts = [r["text"] for r in results]

        # 3. å›ç­”ç”Ÿæˆ
        answer = self.generate_answer(question, contexts)

        return answer


# ä½¿ç”¨ä¾‹
if __name__ == "__main__":
    rag = RAGSystem()

    # ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ä½œæˆ
    rag.create_collection()

    # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¿½åŠ 
    rag.add_documents([
        {"id": 1, "text": "Pythonã®å¤‰æ•°ã¯å‹•çš„å‹ä»˜ã‘ã§ã™ã€‚", "metadata": {"category": "python"}},
        {"id": 2, "text": "foræ–‡ã¯ç¹°ã‚Šè¿”ã—å‡¦ç†ã«ä½¿ã„ã¾ã™ã€‚", "metadata": {"category": "python"}},
    ])

    # ã‚¯ã‚¨ãƒªå®Ÿè¡Œ
    answer = rag.query("å¤‰æ•°ã«ã¤ã„ã¦æ•™ãˆã¦")
    print(answer)
```

### 6.2 æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®å®Ÿè£…

```python
# agent_tools.py ã§ã® Qdrant åˆ©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³

def search_rag_knowledge_base(query: str, collection_name: str = "qa_pairs") -> str:
    """
    ã€å‡¦ç†ãƒ•ãƒ­ãƒ¼ã€‘

    1. ã‚¯ã‚¨ãƒª â†’ åŸ‹ã‚è¾¼ã¿ãƒ™ã‚¯ãƒˆãƒ«
       "APIã®ä»•æ§˜ã¯ï¼Ÿ" â†’ [0.12, -0.34, 0.56, ...]

    2. Qdrantæ¤œç´¢
       qdrant.search(
           collection="qa_pairs",
           vector=[0.12, -0.34, 0.56, ...],
           limit=5
       )

    3. ã‚¹ã‚³ã‚¢ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
       score >= 0.7 ã®ã¿æ¡ç”¨

    4. çµæœãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
       "Q: ... A: ... Score: 0.85"
    """
    pass
```

---

## 7. ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 7.1 ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³è¨­è¨ˆ

```
ã€æ¨å¥¨ã€‘ç›®çš„åˆ¥ã«ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’åˆ†å‰²

âœ… è‰¯ã„ä¾‹:
  - qa_pairs        : FAQã€Q&Aãƒ‡ãƒ¼ã‚¿
  - internal_docs   : ç¤¾å†…æŠ€è¡“ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
  - company_rules   : å°±æ¥­è¦å‰‡ã€ç¤¾å†…è¦å®š
  - product_manuals : è£½å“ãƒãƒ‹ãƒ¥ã‚¢ãƒ«

âŒ æ‚ªã„ä¾‹:
  - all_documents   : å…¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’1ã¤ã«ï¼ˆæ¤œç´¢ç²¾åº¦ä½ä¸‹ï¼‰
```

### 7.2 ãƒãƒ£ãƒ³ã‚¯åˆ†å‰²

```
ã€æ¨å¥¨ã€‘é©åˆ‡ãªãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚º

âœ… æ¨å¥¨ã‚µã‚¤ã‚º: 200ã€œ500ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆç´„400ã€œ1000æ–‡å­—ï¼‰
âœ… ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—: 50ã€œ100ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆæ–‡è„ˆä¿æŒï¼‰

âŒ å°ã•ã™ã: æ–‡è„ˆãŒå¤±ã‚ã‚Œã‚‹
âŒ å¤§ãã™ã: æ¤œç´¢ç²¾åº¦ãŒä½ä¸‹ã€ãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»å¢—
```

```python
# ãƒãƒ£ãƒ³ã‚¯åˆ†å‰²ã®ä¾‹
from langchain.text_splitter import RecursiveCharacterTextSplitter

splitter = RecursiveCharacterTextSplitter(
    chunk_size=500,
    chunk_overlap=100,
    separators=["\n\n", "\n", "ã€‚", "ã€", " "]
)

chunks = splitter.split_text(document_text)
```

### 7.3 ã‚¹ã‚³ã‚¢é–¾å€¤

```python
# æ¨å¥¨é–¾å€¤è¨­å®š
RAG_SCORE_THRESHOLD = 0.7  # Cosineé¡ä¼¼åº¦

# é–¾å€¤ã®è€ƒãˆæ–¹
# 0.9ä»¥ä¸Š: éå¸¸ã«é«˜ã„é–¢é€£æ€§ï¼ˆå®Œå…¨ä¸€è‡´ã«è¿‘ã„ï¼‰
# 0.7-0.9: é«˜ã„é–¢é€£æ€§ï¼ˆæ¡ç”¨æ¨å¥¨ï¼‰
# 0.5-0.7: ä¸­ç¨‹åº¦ã®é–¢é€£æ€§ï¼ˆè¦æ¤œè¨ï¼‰
# 0.5æœªæº€: ä½ã„é–¢é€£æ€§ï¼ˆé™¤å¤–æ¨å¥¨ï¼‰
```

### 7.4 ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–

```python
# HNSW ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­å®š
from qdrant_client.models import HnswConfigDiff

client.update_collection(
    collection_name="documents",
    hnsw_config=HnswConfigDiff(
        m=16,              # ã‚°ãƒ©ãƒ•ã®æ¥ç¶šæ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ16ï¼‰
        ef_construct=100,  # ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ§‹ç¯‰æ™‚ã®æ¢ç´¢æ•°
    )
)

# æ¤œç´¢æ™‚ã®è¨­å®š
results = client.search(
    collection_name="documents",
    query_vector=query_vector,
    limit=5,
    search_params={"hnsw_ef": 128}  # æ¤œç´¢æ™‚ã®æ¢ç´¢æ•°ï¼ˆå¤§ãã„ã»ã©ç²¾åº¦â†‘é€Ÿåº¦â†“ï¼‰
)
```

---

## 8. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### 8.1 ã‚ˆãã‚ã‚‹å•é¡Œ


| å•é¡Œ             | åŸå›                    | è§£æ±ºç­–                           |
| ---------------- | ---------------------- | -------------------------------- |
| æ¥ç¶šã‚¨ãƒ©ãƒ¼       | QdrantãŒèµ·å‹•ã—ã¦ã„ãªã„ | `docker-compose up -d qdrant`    |
| æ¤œç´¢çµæœãŒ0ä»¶    | ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãŒç©º       | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæŠ•å…¥ã‚’ç¢ºèª           |
| ã‚¹ã‚³ã‚¢ãŒå¸¸ã«ä½ã„ | åŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ«ã®ä¸ä¸€è‡´ | ç™»éŒ²æ™‚ã¨æ¤œç´¢æ™‚ã§åŒã˜ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ |
| ãƒ¡ãƒ¢ãƒªä¸è¶³       | å¤§é‡ãƒ‡ãƒ¼ã‚¿             | ãƒ‡ã‚£ã‚¹ã‚¯ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–           |

### 8.2 ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

```python
# 1. ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æƒ…å ±ç¢ºèª
info = client.get_collection("documents")
print(f"Point count: {info.points_count}")
print(f"Vector size: {info.config.params.vectors.size}")

# 2. ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿å–å¾—
points = client.scroll(
    collection_name="documents",
    limit=5
)
for point in points[0]:
    print(f"ID: {point.id}, Payload: {point.payload}")

# 3. Web UIç¢ºèª
# http://localhost:6333/dashboard
```

### 8.3 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°

```yaml
# docker-compose.yml ã§ã®è¨­å®šä¾‹
services:
  qdrant:
    image: qdrant/qdrant:latest
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - ./qdrant_data:/qdrant/storage
    environment:
      - QDRANT__STORAGE__ON_DISK_PAYLOAD=true  # ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’ãƒ‡ã‚£ã‚¹ã‚¯ã«
      - QDRANT__SERVICE__MAX_REQUEST_SIZE_MB=50
```

---

## ä»˜éŒ²

### A. ç”¨èªé›†


| ç”¨èª           | èª¬æ˜                                                      |
| -------------- | --------------------------------------------------------- |
| **Vector**     | æ•°å€¤ã®é…åˆ—ã€‚ãƒ†ã‚­ã‚¹ãƒˆã®æ„å‘³ã‚’æ•°å­¦çš„ã«è¡¨ç¾                  |
| **Embedding**  | ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒ™ã‚¯ãƒˆãƒ«ã«å¤‰æ›ã™ã‚‹ã“ã¨/å¤‰æ›çµæœ                 |
| **Collection** | Qdrantã§ãƒ™ã‚¯ãƒˆãƒ«ã‚’æ ¼ç´ã™ã‚‹è«–ç†å˜ä½                        |
| **Point**      | ãƒ™ã‚¯ãƒˆãƒ« + ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆPayloadï¼‰ã®çµ„                      |
| **Payload**    | ãƒ™ã‚¯ãƒˆãƒ«ã«ä»˜éšã™ã‚‹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆJSONï¼‰                      |
| **ANN**        | Approximate Nearest Neighborï¼ˆè¿‘ä¼¼æœ€è¿‘å‚æ¢ç´¢ï¼‰            |
| **HNSW**       | Hierarchical Navigable Small Worldï¼ˆé«˜é€ŸANNã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼‰ |

### B. å‚è€ƒãƒªãƒ³ã‚¯

- [Qdrant å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://qdrant.tech/documentation/)
- [Qdrant GitHub](https://github.com/qdrant/qdrant)
- [Gemini Embedding API](https://ai.google.dev/gemini-api/docs/embeddings)
- [RAGè«–æ–‡ï¼ˆLewis et al., 2020ï¼‰](https://arxiv.org/abs/2005.11401)

### C. Docker Compose è¨­å®šä¾‹

```yaml
# docker-compose.yml
version: '3.8'

services:
  qdrant:
    image: qdrant/qdrant:latest
    container_name: qdrant
    ports:
      - "6333:6333"  # REST API
      - "6334:6334"  # gRPC
    volumes:
      - ./qdrant_data:/qdrant/storage
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    container_name: redis
    ports:
      - "6379:6379"
    volumes:
      - ./redis_data:/data
    command: redis-server --appendonly yes
    restart: unless-stopped
```

---

**Document Version:** 1.0
**Last Updated:** 2025/12/05
